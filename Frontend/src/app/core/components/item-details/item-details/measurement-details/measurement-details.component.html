<ng-container *ngIf="measurementId && (measurementDetails$ | async) as details">
  <mat-card-content>
    <article class="measurement-details">
      <div class="measurement-details__header">Measurement {{details.code}}</div>
      <div class="measurement-details__label">Created:</div>
      <div>{{details.createdAtUtc | date:'medium'}}</div>
      <div class="measurement-details__label">Tags: </div>
      <div>
        <mat-chip-set>
          <mat-chip *ngFor="let tag of details.tags">{{tag}}</mat-chip>
        </mat-chip-set>
      </div>
      <div class="measurement-details__label">Comment:</div>
      <div>{{details.comment}}</div>
      <div class="measurement-details__label">Number of steps:</div>
      <div>{{details.steps.length}}</div>
    </article>

    <mat-card *ngIf="isDetailView()">
      <mat-card-header>
        <mat-card-title>Steps</mat-card-title>
      </mat-card-header>

      <mat-divider></mat-divider>

      <mat-card-content>
        <mat-card *ngFor="let step of details.steps">
          <mat-card-content>
            <mat-table [dataSource]="step.parameters">
              <ng-container matColumnDef="name">
                <mat-header-cell *matHeaderCellDef>Name</mat-header-cell>
                <mat-cell *matCellDef="let parameter">{{parameter.name}}</mat-cell>
              </ng-container>

              <ng-container matColumnDef="value">
                <mat-header-cell *matHeaderCellDef>Value</mat-header-cell>
                <mat-cell *matCellDef="let parameter">{{parameter.value}}</mat-cell>
              </ng-container>

              <ng-container matColumnDef="unit">
                <mat-header-cell *matHeaderCellDef>Unit</mat-header-cell>
                <mat-cell *matCellDef="let parameter">{{parameter.unit}}</mat-cell>
              </ng-container>

              <ng-container matColumnDef="$type">
                <mat-header-cell *matHeaderCellDef>Type</mat-header-cell>
                <mat-cell *matCellDef="let parameter">{{parameter.$type}}</mat-cell>
              </ng-container>

              <mat-header-row *matHeaderRowDef="['name', 'value', 'unit', '$type']"></mat-header-row>
              <mat-row *matRowDef="let row; columns: ['name', 'value', 'unit', '$type']"></mat-row>
            </mat-table>
          </mat-card-content>
        </mat-card>
      </mat-card-content>
    </mat-card>
  </mat-card-content>


  <mat-card-actions>
    <button mat-button color="primary">
      <mat-icon>redo</mat-icon>
      Redo
    </button>
    <button mat-button color="primary" *ngIf="!isDetailView()" [routerLink]="['/measurements', measurementId]">
      <mat-icon>arrow_forward</mat-icon>
      Show steps
    </button>
    <button mat-button color="primary" *ngIf="hasRecipe(details)"> [routerLink]="['/recipes', details.recipeId]"
      <mat-icon>arrow_forward</mat-icon>
      Show recipe
    </button>
    <button mat-button color="primary" *ngIf="isDetailView()" (click)="export(details)">
      <mat-icon>file_download</mat-icon>
      Export to CSV
    </button>
  </mat-card-actions>

  <mat-card-footer>
    <mat-progress-bar [mode]="loading"></mat-progress-bar>
  </mat-card-footer>
</ng-container>
